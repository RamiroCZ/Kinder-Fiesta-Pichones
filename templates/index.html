<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Kinder Fiesta</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body>
  <!-- Encabezado -->
  <header>
    <div class="header-left">
      <img src="{{ url_for('static', filename='logo.jpeg') }}" alt="Logo KinderFiesta">
      <h1>Kinder Fiesta</h1>
    </div>

    <div class="header-right">
      <button id="adminBtn" class="btn-admin" type="button">Login Admin</button>
      <button id="logoutBtn" class="btn-admin" type="button" style="display:none;">Logout Admin</button>
      <button id="sugerirBtn" class="btn-sugerir" type="button">Sugerir Sal√≥n</button>
      <button id="verSugerenciasBtn" class="btn-admin" type="button" style="display:none;">Ver sugerencias</button>
    </div>
  </header>

  <!-- Buscador -->
  <div id="buscador">
    <input type="text" id="searchInput" placeholder="Buscar sal√≥n por nombre...">
  </div>

  <!-- Contenedor principal -->
  <main id="salones-container">
    {% for group in salones|batch(4, none) %}
      <div class="salon-group">
        <div class="salon-group-inner">
          {% for s in group if s %}
            <section id="salon-{{ s.id }}" class="salon" data-nombre="{{ s.nombre | lower }}">
              <h2>{{ s.nombre }}</h2>

              <div class="imagen-rotativa" data-timer="">
                <button class="flecha izq" type="button">&#10094;</button>
                <img
                  src="{{ url_for('static', filename=(s.imagenes[0] if s.imagenes else 'S1.PNG')) }}"
                  alt="Foto de {{ s.nombre }}"
                  data-imgs='{{ s.imagenes | tojson }}'
                  data-index="0">
                <button class="flecha der" type="button">&#10095;</button>
              </div>

              <p><strong>Direcci√≥n:</strong> {{ s.direccion }}</p>
              <p><strong>Tel√©fono:</strong> {{ s.telefono }}</p>
              <p><strong>Mapa:</strong> <a href="{{ s.mapa_url }}" target="_blank">Ver en Google Maps</a></p>
              <p><strong>Calificaci√≥n promedio:</strong> <span class="promedio">{{ s.promedio if s.promedio else "Sin calificaciones" }}</span></p>

              <details>
                <summary>Ver comentarios</summary>
                <div id="comentarios-{{ s.id }}" class="comentarios"></div>
              </details>

              <form class="comentario-form" data-salon-id="{{ s.id }}">
                <label>Nombre <input type="text" name="usuario" required maxlength="50"></label>
                <label>Comentario <textarea name="comentario" required maxlength="200"></textarea></label>
                <label class="estrellas-label">
                  Estrellas ‚≠ê
                  <select name="estrellas" required>
                    <option value="5">5</option><option value="4">4</option>
                    <option value="3">3</option><option value="2">2</option>
                    <option value="1">1</option>
                  </select>
                </label>
                <button type="submit">Enviar valoraci√≥n</button>
                <div class="form-msg"></div>
              </form>

              <!-- BOT√ìN DE ELIMINAR -->
              <button class="admin-del"
               data-id="{{ s.id }}"
               style="display:none">
              Eliminar sal√≥n
              </button>
            </section>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </main>

  <!-- Modal Login Admin -->
  <div id="modalLogin" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" data-close="modalLogin">&times;</span>
      <h3>Acceso administrador</h3>
      <form id="adminLoginForm">
        <input type="text" name="usuario" required placeholder="Usuario">
        <input type="password" name="clave" required placeholder="Contrase√±a">
        <button type="submit" class="btn-admin">Ingresar</button>
        <div class="login-msg"></div>
      </form>
    </div>
  </div>

  <!-- Modal Logout -->
  <div id="modalLogout" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close" data-close="modalLogout">&times;</span>
      <h3>Sesi√≥n cerrada</h3>
      <p>Hasta pronto, administrador üëã</p>
    </div>
  </div>

  <!-- Modal Sugerir -->
  <div id="modalSugerir" class="modal" style="display: none;">
    <div class="modal-content">
      <span class="close" data-close="modalSugerir">&times;</span>
      <h3>Sugerir nuevo sal√≥n</h3>
      <form id="sugerirForm" action="/sugerir" method="post" enctype="multipart/form-data">
        <input type="text" name="nombre" required placeholder="Nombre del sal√≥n">
        <input type="text" name="direccion" required placeholder="Direcci√≥n">
        <input type="text" name="telefono" required placeholder="Tel√©fono">
        <input type="url" name="mapa_url" required placeholder="URL de Google Maps">

        <label for="imagenes">Im√°genes del sal√≥n (m√≠nimo 1, m√°ximo 3)</label>
        <input type="file" id="imagenes" name="imagenes" accept="image/*" multiple required>
        <div id="preview" class="preview"></div>

        <button type="submit" class="btn-sugerir">Enviar sugerencia</button>
        <div class="sugerir-msg"></div>
      </form>
    </div>
  </div>

  <!-- Modal Ver Sugerencias -->
  <div id="modalSugerencias" class="modal" style="display:none;">
    <div class="modal-content">
      <span class="close" data-close="modalSugerencias">&times;</span>
      <h3>Sugerencias pendientes</h3>
      <div id="listaSugerencias"></div>
      <div class="sugerencias-msg"></div>
    </div>
  </div>

  <!-- MODAL √öNICO PARA ELIMINAR SAL√ìN -->
  <div id="modal-eliminar" class="modal" style="display:none">
    <div class="modal-content">
      <span class="close" data-close="modal-eliminar">&times;</span>
      <h3>Confirmar eliminaci√≥n</h3>
      <p>Ingresa la contrase√±a de admin para eliminar el sal√≥n:</p>
      <input type="password" id="password-admin" placeholder="Contrase√±a">
      <button id="btnEliminarConfirmar">Eliminar</button>
    </div>
  </div>

  <!-- Script principal -->
  <script src="{{ url_for('static', filename='main.js') }}" defer></script>

  <!-- SCRIPT PARA ELIMINAR SIN PROMPT -->
  <script>
    function mostrarModalEliminar(idSalon) {
      const modal = document.getElementById("modal-eliminar");
      modal.dataset.id = idSalon;
      document.getElementById("password-admin").value = "";
      modal.style.display = "flex";
    }

    document.getElementById("btnEliminarConfirmar").addEventListener("click", async () => {
      const modal = document.getElementById("modal-eliminar");
      const idSalon = modal.dataset.id;
      const password = document.getElementById("password-admin").value;

      if (!password) {
        alert("Ingrese la contrase√±a");
        return;
      }

      const formData = new FormData();
      formData.append("password", password);

      const response = await fetch(`/eliminar_salon/${idSalon}`, {
        method: "POST",
        body: formData
      });

      const result = await response.json();

      if (result.success) {
        alert("Sal√≥n eliminado correctamente");
        window.location.reload();
      } else {
        alert("Contrase√±a incorrecta");
      }

      modal.style.display = "none";
    });
  </script>

</body>
</html>

















